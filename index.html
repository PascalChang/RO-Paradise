<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RO 掉落物品查詢</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        #app {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            margin: 50px 0;
        }

        .error {
            text-align: center;
            color: #ff6b6b;
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .item-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            flex: 1;
        }

        .search-section {
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            align-items: end;
        }

        .search-group, .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .search-group label, .filter-group label {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .search-input, .series-filter, .level-filter {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .search-input:focus, .series-filter:focus, .level-filter:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .table-container {
            overflow-x: auto;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        .items-table th,
        .items-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        .items-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s ease;
        }

        .items-table th:hover {
            background: #e9ecef !important;
        }

        .sort-icon {
            margin-left: 5px;
            color: #667eea;
            font-weight: bold;
        }

        .item-row:hover {
            background: #f8f9fa;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .item-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .job-restriction {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .level-restriction, .weapon-level {
            text-align: center;
            font-weight: 600;
            color: #495057;
        }

        .series {
            color: #667eea;
            font-weight: 600;
        }

        .monster {
            color: #dc3545;
            font-weight: 500;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #e1e5e9;
        }

        .page-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .page-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            color: #6c757d;
            font-weight: 500;
        }

        .stats {
            padding: 15px;
            background: #e9ecef;
            text-align: center;
            color: #495057;
            font-weight: 500;
            border-top: 1px solid #dee2e6;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            color: white;
            opacity: 0.8;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            #app {
                padding: 10px;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            header p {
                font-size: 1rem;
            }

            .search-section {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .items-table th,
            .items-table td {
                padding: 10px 8px;
                font-size: 0.9rem;
            }
            
            .pagination {
                flex-direction: column;
                gap: 10px;
            }
            
            .job-restriction {
                font-size: 0.8rem;
            }
        }
    </style>
  </head>
  <body>
    <div id="app">
        <header>
            <h1>RO 掉落物品查詢</h1>
            <p>快速查詢仙境傳說武器掉落來源</p>
        </header>
        
        <main>
            <div id="loading" class="loading">
                載入中...
            </div>
            
            <div id="error" class="error" style="display: none;">
                <h3>載入失敗</h3>
                <p id="error-message"></p>
                <button onclick="loadData()" style="margin-top: 10px; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    重新載入
                </button>
            </div>
            
            <div id="content" class="item-table" style="display: none;">
                <div class="search-section">
                    <div class="search-group">
                        <label for="search">搜尋：</label>
                        <input 
                            id="search"
                            placeholder="搜尋物品名稱、職業、掉落魔物..."
                            class="search-input"
                        />
                    </div>
                    
                    <div class="filter-group">
                        <label for="series-filter">武器系列：</label>
                        <select id="series-filter" class="series-filter">
                            <option value="">所有系列</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="level-filter">等級限制：</label>
                        <select id="level-filter" class="level-filter">
                            <option value="">所有等級</option>
                            <option value="1">1級</option>
                            <option value="2">2級</option>
                            <option value="3">3級</option>
                            <option value="4">4級</option>
                            <option value="12">12級</option>
                            <option value="14">14級</option>
                            <option value="16">16級</option>
                            <option value="18">18級</option>
                            <option value="24">24級</option>
                            <option value="27">27級</option>
                            <option value="30">30級</option>
                            <option value="33">33級</option>
                            <option value="無">無限制</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="items-table">
                        <thead>
                            <tr>
                                <th onclick="sortBy('名稱')" class="sortable">
                                    物品名稱
                                    <span id="sort-名稱" class="sort-icon">↑</span>
                                </th>
                                <th onclick="sortBy('職業限制')" class="sortable">
                                    職業限制
                                    <span id="sort-職業限制" class="sort-icon" style="display: none;"></span>
                                </th>
                                <th onclick="sortBy('等級限制')" class="sortable">
                                    等級限制
                                    <span id="sort-等級限制" class="sort-icon" style="display: none;"></span>
                                </th>
                                <th onclick="sortBy('武器等級')" class="sortable">
                                    武器等級
                                    <span id="sort-武器等級" class="sort-icon" style="display: none;"></span>
                                </th>
                                <th onclick="sortBy('系列')" class="sortable">
                                    系列
                                    <span id="sort-系列" class="sort-icon" style="display: none;"></span>
                                </th>
                                <th onclick="sortBy('掉落魔物')" class="sortable">
                                    掉落魔物
                                    <span id="sort-掉落魔物" class="sort-icon" style="display: none;"></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination">
                    <button id="prev-btn" class="page-btn">
                        上一頁
                    </button>
                    <span id="page-info" class="page-info">
                        第 1 頁，共 1 頁
                    </span>
                    <button id="next-btn" class="page-btn">
                        下一頁
                    </button>
                </div>
                
                <div id="stats" class="stats">
                    顯示 0 / 0 個物品
                </div>
            </div>
        </main>
        
        <footer>
            <p>資料來源：RO 掉落物品簡易整理表</p>
        </footer>
    </div>

    <script>
        // 全域變數
        let allItems = [];
        let filteredItems = [];
        let currentPage = 1;
        let itemsPerPage = 20;
        let sortKey = '名稱';
        let sortOrder = 'asc';

        // 載入資料
        async function loadData() {
            showLoading();
            
            try {
                const response = await fetch('./src/data/items.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                allItems = await response.json();
                
                // 初始化
                populateSeriesFilter();
                filterAndRender();
                showContent();
                
            } catch (err) {
                showError(`載入資料失敗: ${err.message}`);
                console.error('載入資料失敗:', err);
            }
        }

        // 顯示載入中
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('content').style.display = 'none';
        }

        // 顯示錯誤
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('content').style.display = 'none';
            document.getElementById('error-message').textContent = message;
        }

        // 顯示內容
        function showContent() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('content').style.display = 'block';
        }

        // 填充系列篩選器
        function populateSeriesFilter() {
            const series = [...new Set(allItems.map(item => item.系列))].sort();
            const select = document.getElementById('series-filter');
            
            // 清空現有選項（保留"所有系列"）
            select.innerHTML = '<option value="">所有系列</option>';
            
            // 加入系列選項
            series.forEach(s => {
                const option = document.createElement('option');
                option.value = s;
                option.textContent = s;
                select.appendChild(option);
            });
        }

        // 篩選和渲染
        function filterAndRender() {
            const searchQuery = document.getElementById('search').value.toLowerCase();
            const selectedSeries = document.getElementById('series-filter').value;
            const selectedLevel = document.getElementById('level-filter').value;

            // 篩選
            filteredItems = allItems.filter(item => {
                const matchesSearch = !searchQuery || 
                    item.名稱.toLowerCase().includes(searchQuery) ||
                    item.職業限制.toLowerCase().includes(searchQuery) ||
                    item.掉落魔物.toLowerCase().includes(searchQuery);
                
                const matchesSeries = !selectedSeries || item.系列 === selectedSeries;
                const matchesLevel = !selectedLevel || item.等級限制 === selectedLevel;
                
                return matchesSearch && matchesSeries && matchesLevel;
            });

            // 排序
            sortItems();
            
            // 重置分頁
            currentPage = 1;
            
            // 渲染
            renderTable();
            updatePagination();
            updateStats();
        }

        // 排序
        function sortItems() {
            filteredItems.sort((a, b) => {
                let aVal = a[sortKey];
                let bVal = b[sortKey];
                
                // 處理等級限制的排序
                if (sortKey === '等級限制') {
                    if (aVal === '無') aVal = 0;
                    if (bVal === '無') bVal = 0;
                    aVal = parseInt(aVal) || 0;
                    bVal = parseInt(bVal) || 0;
                }
                
                if (sortOrder === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
        }

        // 排序功能
        function sortBy(key) {
            if (sortKey === key) {
                sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
            } else {
                sortKey = key;
                sortOrder = 'asc';
            }
            
            // 更新排序圖示
            updateSortIcons();
            
            // 重新排序和渲染
            sortItems();
            renderTable();
        }

        // 更新排序圖示
        function updateSortIcons() {
            const keys = ['名稱', '職業限制', '等級限制', '武器等級', '系列', '掉落魔物'];
            
            keys.forEach(key => {
                const icon = document.getElementById(`sort-${key}`);
                if (key === sortKey) {
                    icon.style.display = 'inline';
                    icon.textContent = sortOrder === 'asc' ? '↑' : '↓';
                } else {
                    icon.style.display = 'none';
                }
            });
        }

        // 渲染表格
        function renderTable() {
            const tbody = document.getElementById('table-body');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageItems = filteredItems.slice(start, end);
            
            tbody.innerHTML = '';
            
            pageItems.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'item-row';
                
                row.innerHTML = `
                    <td class="item-name">${item.名稱}</td>
                    <td class="job-restriction">${item.職業限制}</td>
                    <td class="level-restriction">${item.等級限制}</td>
                    <td class="weapon-level">${item.武器等級}</td>
                    <td class="series">${item.系列}</td>
                    <td class="monster">${item.掉落魔物}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // 更新分頁
        function updatePagination() {
            const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const pageInfo = document.getElementById('page-info');
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            pageInfo.textContent = `第 ${currentPage} 頁，共 ${totalPages} 頁`;
        }

        // 更新統計
        function updateStats() {
            const stats = document.getElementById('stats');
            stats.textContent = `顯示 ${filteredItems.length} / ${allItems.length} 個物品`;
        }

        // 上一頁
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
                updatePagination();
            }
        }

        // 下一頁
        function nextPage() {
            const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
                updatePagination();
            }
        }

        // 事件監聽器
        document.addEventListener('DOMContentLoaded', function() {
            // 載入資料
            loadData();
            
            // 搜尋事件
            document.getElementById('search').addEventListener('input', filterAndRender);
            
            // 篩選事件
            document.getElementById('series-filter').addEventListener('change', filterAndRender);
            document.getElementById('level-filter').addEventListener('change', filterAndRender);
            
            // 分頁事件
            document.getElementById('prev-btn').addEventListener('click', prevPage);
            document.getElementById('next-btn').addEventListener('click', nextPage);
        });
    </script>
  </body>
</html> 